<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">

<body>
	<f:metadata>
		<f:event type="preRenderView"
			listener="#{consultaEmpresaController.exibeMensagens}" />
	</f:metadata>

	<ui:composition template="/tema/templates/template.xhtml">

		<ui:define name="titulo">
			#{msgs['title.sistema']} | #{msgs['title.uc005.consulta.empresas']}
		</ui:define>

		<ui:define name="breadcrumb">
			<a target="_top"
				href="/#{menuController.appName}/paginas/principal.xhtml"> <h:outputText
					value="#{msgs['title.principal']}" />
			</a> > <h:outputText value="#{msgs['title.uc005.consulta.empresas']}" />
		</ui:define>

		<ui:define name="tools">
			<p:toolbar
				styleClass="flex flex-column md:flex-row justify-content-between align-items-start gap-3">

				<p:toolbarGroup align="left"
					styleClass="flex flex-wrap gap-2 justify-start w-full md:w-auto">

					<p:commandButton id="acaoNovo"
						action="#{consultaEmpresaController.novo}" icon="pi pi-plus"
						process="@this" update="@form"
						title="#{msgs['alt.acao.nova.empresa']}" styleClass="mr-2" />


					<p:commandButton id="acaoExportar" icon="pi pi-file-excel"
						title="#{msgs['alt.acao.exportar']}" ajax="false"
						styleClass="rounded-button ui-button-flat">
						<p:dataExporter type="xlsx" target="form:empresasTable"
							fileName="empresas" />
					</p:commandButton>
				</p:toolbarGroup>

				<p:toolbarGroup align="right"
					styleClass="flex flex-wrap gap-2 justify-start md:justify-end w-full md:w-auto">
					
					
					<!-- Campo único de busca -->
					<p:commandButton id="acaoLimpar"
						action="#{consultaEmpresaController.limpar}"
						icon="pi pi-filter" process="@this"
						update="@form" title="#{msgs['alt.acao.limpar']}"
						styleClass="rounded-button ui-button-flat" />

					<p:inputText id="filtro-geral"
						placeholder="Buscar por nome ou CNPJ"
						value="#{consultaEmpresaController.paramBuscaGeral}"
						styleClass="w-full md:w-80" />

					<p:commandButton id="acaoBuscar"
						action="#{consultaEmpresaController.buscar}" icon="pi pi-search"
						process="@form" update="@form" title="#{msgs['alt.acao.buscar']}"
						style="" />
				</p:toolbarGroup>
			</p:toolbar>
		</ui:define>

		<ui:define name="conteudo">

			<h:panelGrid width="100%" columns="1" headerClass="h-grid-header">
				<f:facet name="header">
					<h:outputText value="#{msgs['title.uc005.consulta.empresas']}" />
				</f:facet>

				<h:column>

					<ui:include src="/tema/templates/vazio.xhtml">
						<ui:param name="exibe"
							value="#{empty consultaEmpresaController.result}" />
						<ui:param name="exibeAdicionar" value="true" />
					</ui:include>

					<p:dataTable id="empresasTable"
						value="#{consultaEmpresaController.result}" var="empresa"
						rendered="#{not empty consultaEmpresaController.result}"
						paginator="true"
						rows="#{consultaEmpresaController.quantPorPagina}"
						paginatorPosition="bottom" paginatorAlwaysVisible="false">

						<p:column headerText="#{msgs['label.uc005.codigo']}"
							style="text-align: center">
							<h:outputText value="#{empresa.id}" />
						</p:column>

						<p:column headerText="#{msgs['label.uc005.nome.empresa']}"
							style="text-align: center">
							<h:outputText value="#{empresa.nome}" />
						</p:column>

						<p:column headerText="#{msgs['label.uc005.email']}"
							style="text-align: center">
							<h:outputText value="#{empresa.email}" />
						</p:column>

						<p:column headerText="#{msgs['label.uc005.telefone']}"
							style="text-align: center">
							<h:outputText value="#{empresa.telefone}" />
						</p:column>

						<p:column headerText="#{msgs['label.uc005.celular']}"
							style="text-align: center">
							<h:outputText value="#{empresa.celular}" />
						</p:column>

						<p:column headerText="#{msgs['label.uc005.cnpj']}"
							style="text-align: center">
							<h:outputText value="#{empresa.cnpj}">
								<f:converter converterId="cnpjConverter" />
							</h:outputText>
						</p:column>

						<p:column headerText="#{msgs['alt.acao.editar']}"
							style="text-align: center;width: 40px" exportable="false">
							<h:commandButton id="botaoEditarEmpresa"
								action="#{consultaEmpresaController.editar(empresa.id)}"
								title="#{msgs['alt.acao.editar.empresa']}"
								image="#{menuController.path}/tema/img/bt_edit_min.png">
							</h:commandButton>
						</p:column>

						<p:column headerText="#{msgs['alt.acao.excluir']}"
							style="text-align: center;width: 40px" exportable="false">
							<h:commandButton
								image="#{menuController.path}/tema/img/bt_remove_min.png"
								title="#{msgs['alt.acao.excluir']}">

								<f:setPropertyActionListener value="#{empresa}"
									target="#{consultaEmpresaController.empresaSelecionada}" />
								<p:ajax oncomplete="PF('confirmarExclusao').show()"></p:ajax>
							</h:commandButton>
						</p:column>

					</p:dataTable>

				</h:column>

			</h:panelGrid>

			<p:confirmDialog id="dialogConfirmarExclusao"
				widgetVar="confirmarExclusao" header="Confirmar"
				message="Tem certeza que deseja excluir esta empresa?">

				<p:button value="Não"
					onclick="PF('confirmarExclusao').hide(); return false;" />
				<p:commandButton value="Sim"
					oncomplete="PF('confirmarExclusao').hide();"
					action="#{consultaEmpresaController.excluirEmpresa()}"
					process="@this" update="@form" />
			</p:confirmDialog>

		</ui:define>

	</ui:composition>

</body>
</html>